window.RTCPeerConnection=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var Hello=function(a){var b=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?"firefox":"chrome";this.options=a,this._events={};var c={iceServers:[{url:"stun:stun.l.google.com:19302"}]},d={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{DtlsSrtpKeyAgreement:!0}]};"firefox"===b&&(c.iceServers=[{url:"stun:23.21.150.121"}],d={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,MozDontOfferDataChannel:!0}}),a.socket=a.socket||"",c.iceServers=a.iceServers||c.iceServers;var e="string"==typeof a.socket?io.connect(a.socket):a.socket,f=new RTCPeerConnection(c,d),g=function(a){f.setLocalDescription(a),e.emit("hello:answer",a)};f.onaddstream=function(a){var b=URL.createObjectURL(a.stream);this.options.remote&&(this.options.remote.src=b),this.options.remoteCallback&&this.options.remoteCallback(b)}.bind(this),f.onicecandidate=function(a){a.candidate&&(e.emit("hello:ice",a.candidate),f.onicecandidate=null)},f.onopen=function(){},e.on("hello:offer",function(a){f.setRemoteDescription(new RTCSessionDescription(a)),f.createAnswer(g)}),e.on("hello:answer",function(a){f.setRemoteDescription(new RTCSessionDescription(a))}.bind(this)),e.on("hello:ice",function(a){f.addIceCandidate(new RTCIceCandidate(a))}),e.on("hello:call",function(a){this.pendingCalls[a]=new Date,this._events.call&&this._events.call(a)}.bind(this)),e.on("hello:disconnect",function(a){this._events.disconnect&&this._events.disconnect(a),this.options.remote&&(this.options.remote.src=""),this.options.remoteCallback&&this.options.remoteCallback("")}.bind(this)),this.socket=e,this.stream=null,this.pendingCalls={},this.peerConnection=f};Hello.prototype.on=function(a,b){this._events[a]=b},Hello.prototype.register=function(a){this.socket.emit("hello:register",a)},Hello.prototype.call=function(a,b){var c={audio:!0,video:!0};b=b||{},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),b.callbacks&&(this.options.remoteCallback=b.callbacks.remote);var d=function(c){var d=URL.createObjectURL(c);this.stream=c,this.peerConnection.addStream(this.stream),this.options.local&&(this.options.local.src=d),b.callbacks&&b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(d),this.socket.emit("hello:call",a)}.bind(this),e=function(){console.error(arguments)};navigator.getUserMedia(c,d,e)},Hello.prototype.answer=function(a,b){var c=this.pendingCalls[a],d={audio:!0,video:!0};if(b=b||{},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),b.callbacks&&(this.options.remoteCallback=b.callbacks.remote),c){var e=function(a){var c=URL.createObjectURL(a);this.stream=a,this.options.local&&(this.options.local.src=c),b.callbacks&&b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(c),this.peerConnection.addStream(this.stream),this.peerConnection.createOffer(function(a){this.peerConnection.setLocalDescription(a),this.socket.emit("hello:offer",a)}.bind(this))}.bind(this),f=function(){console.error(arguments)};navigator.getUserMedia(d,e,f)}};
//# sourceMappingURL=hellortc.map.js