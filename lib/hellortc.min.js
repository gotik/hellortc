window.RTCPeerConnection=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var Hello=function(a){this.options=a,this._events={},a.socket=a.socket||"",a.iceServers=a.iceServers||[{url:"stun:23.21.150.121"},{url:"stun:stun.l.google.com:19302"}];var b="string"==typeof a.socket?io.connect(a.socket):a.socket,c=new RTCPeerConnection({iceServers:a.iceServers},{optional:[{RtpDataChannels:!0}]}),d=function(a){c.setLocalDescription(a),b.emit("hello:answer",a)};c.onaddstream=function(a){var b=URL.createObjectURL(a.stream);this.options.remote&&(this.options.remote.src=b),this.options.remoteCallback&&this.options.remoteCallback(b)}.bind(this),c.onicecandidate=function(a){a.candidate&&(b.emit("hello:ice",a.candidate),c.onicecandidate=null)},c.onopen=function(){},b.on("hello:offer",function(a){c.setRemoteDescription(new RTCSessionDescription(a)),c.createAnswer(d)}),b.on("hello:answer",function(a){c.setRemoteDescription(new RTCSessionDescription(a))}.bind(this)),b.on("hello:ice",function(a){c.addIceCandidate(new RTCIceCandidate(a))}),b.on("hello:call",function(a){this.pendingCalls[a]=new Date,this._events.call&&this._events.call(a)}.bind(this)),b.on("hello:disconnect",function(a){this._events.disconnect&&this._events.disconnect(a),this.options.remote.src="",this.options.remoteCallback&&this.options.remoteCallback("")}.bind(this)),this.socket=b,this.stream=null,this.pendingCalls={},this.peerConnection=c};Hello.prototype.on=function(a,b){this._events[a]=b},Hello.prototype.register=function(a){this.socket.emit("hello:register",a)},Hello.prototype.call=function(a,b){var c={audio:!0,video:!0};b=b||{callbacks:{}},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),this.options.remoteCallback=b.callbacks.remote;var d=function(c){var d=URL.createObjectURL(c);this.stream=c,this.peerConnection.addStream(this.stream),this.options.local&&(this.options.local.src=d),b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(d),this.socket.emit("hello:call",a)}.bind(this),e=function(){console.error(arguments)};navigator.getUserMedia(c,d,e)},Hello.prototype.answer=function(a,b){var c=this.pendingCalls[a],d={audio:!0,video:!0};if(b=b||{callbacks:{}},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),this.options.remoteCallback=b.callbacks.remote,c){var e=function(a){var c=URL.createObjectURL(a);this.stream=a,this.options.local&&(this.options.local.src=c),b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(c),this.peerConnection.addStream(this.stream),this.peerConnection.createOffer(function(a){this.peerConnection.setLocalDescription(a),this.socket.emit("hello:offer",a)}.bind(this))}.bind(this),f=function(){console.error(arguments)};navigator.getUserMedia(d,e,f)}};
//# sourceMappingURL=hellortc.map.js