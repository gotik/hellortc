function trace(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+a)}HELLORTC_DEBUG=!0,window.RTCPeerConnection=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;navigator.mozGetUserMedia?(console.log("This appears to be Firefox"),webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn"))if(27>webrtcDetectedVersion){var f=a.split("?");0===f[1].indexOf("transport=udp")&&(d={url:f[0],credential:c,username:b})}else d={url:a,credential:c,username:b};return d},attachMediaStream=function(a,b){console.log("Attaching media stream"),a.mozSrcObject=b,a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream"),a.mozSrcObject=b.mozSrcObject,a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):navigator.webkitGetUserMedia?(console.log("This appears to be Chrome"),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10),createIceServer=function(a,b,c){var d=null,e=a.split(":");return 0===e[0].indexOf("stun")?d={url:a}:0===e[0].indexOf("turn")&&(d={url:a,credential:c,username:b}),d},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(a,b){"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")},reattachMediaStream=function(a,b){a.src=b.src}):console.log("Browser does not appear to be WebRTC-capable");var Hello=function(a){this.options=a,this._events={};var b={iceServers:[{url:"stun:stun.l.google.com:19302"}]},c={optional:[{DtlsSrtpKeyAgreement:!0}]},d={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};"firefox"===webrtcDetectedBrowser&&(b.iceServers=[{url:"stun:23.21.150.121"}],d={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0,MozDontOfferDataChannel:!0}}),a.socket=a.socket||"",b.iceServers=a.iceServers||b.iceServers,this._sdpConstraints=d;var e="string"==typeof a.socket?io.connect(a.socket):a.socket,f=new RTCPeerConnection(b,c),g=function(a){HELLORTC_DEBUG&&console.log("created answer",a),f.setLocalDescription(a),e.emit("hello:answer",a)};f.onaddstream=function(a){var b=URL.createObjectURL(a.stream);HELLORTC_DEBUG&&console.log("remote stream",a),this.options.remote&&attachMediaStream(this.options.remote,a.stream),this.options.remoteCallback&&this.options.remoteCallback(b,a.stream)}.bind(this),f.onicecandidate=function(a){HELLORTC_DEBUG&&console.log("local ice",a),a.candidate&&e.emit("hello:ice",a.candidate)},f.onopen=function(){HELLORTC_DEBUG&&console.log("open",arguments)},e.on("hello:offer",function(a){HELLORTC_DEBUG&&console.log("offer",a),f.setRemoteDescription(new RTCSessionDescription(a)),f.createAnswer(g,function(){},this._sdpConstraints)}.bind(this)),e.on("hello:answer",function(a){HELLORTC_DEBUG&&console.log("answer",a),f.setRemoteDescription(new RTCSessionDescription(a))}.bind(this)),e.on("hello:ice",function(a){HELLORTC_DEBUG&&console.log("remote ice",a),f.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:a.sdpMLineIndex,candidate:a.candidate}))}),e.on("hello:call",function(a){HELLORTC_DEBUG&&console.log(a,"is calling you"),this.pendingCalls[a]=new Date,this._events.call&&this._events.call(a)}.bind(this)),e.on("hello:disconnect",function(a){HELLORTC_DEBUG&&console.log(a," disconnect"),this._events.disconnect&&this._events.disconnect(a),this.options.remote&&(this.options.remote.src=""),this.options.remoteCallback&&this.options.remoteCallback("")}.bind(this)),this.socket=e,this.stream=null,this.pendingCalls={},this.peerConnection=f};Hello.prototype.on=function(a,b){this._events[a]=b},Hello.prototype.register=function(a){this.socket.emit("hello:register",a)},Hello.prototype.call=function(a,b){var c={audio:!0,video:!0};b=b||{},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),b.callbacks&&(this.options.remoteCallback=b.callbacks.remote);var d=function(c){var d=URL.createObjectURL(c);this.stream=c,this.peerConnection.addStream(this.stream),this.options.local&&attachMediaStream(this.options.local,c),b.callbacks&&b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(d,c),this.socket.emit("hello:call",a)}.bind(this),e=function(){console.error(arguments)};navigator.getUserMedia(c,d,e)},Hello.prototype.answer=function(a,b){var c=this.pendingCalls[a],d={audio:!0,video:!0};if(b=b||{},b.remote&&(this.options.remote=b.remote),b.local&&(this.options.local=b.local),b.callbacks&&(this.options.remoteCallback=b.callbacks.remote),c){var e=function(a){var c=URL.createObjectURL(a);this.stream=a,this.options.local&&attachMediaStream(this.options.local.src,a),b.callbacks&&b.callbacks.local&&"function"==typeof b.callbacks.local&&b.callbacks.local(c,a),this.peerConnection.addStream(this.stream),this.peerConnection.createOffer(function(a){this.peerConnection.setLocalDescription(a),this.socket.emit("hello:offer",a)}.bind(this),function(){},this._sdpConstraints)}.bind(this),f=function(){console.error(arguments)};navigator.getUserMedia(d,e,f)}};
//# sourceMappingURL=hellortc.map.js