window.RTCPeerConnection=window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var Hello=function(a){this.options=a,this._events={},a.socket=a.socket||"",a.iceServers=a.iceServers||[{url:"stun:23.21.150.121"},{url:"stun:stun.l.google.com:19302"}];var b="string"==typeof a.socket?io.connect(a.socket):a.socket,c=new RTCPeerConnection({iceServers:a.iceServers},{optional:[{RtpDataChannels:!0}]}),d=function(a){c.setLocalDescription(a),b.emit("hello:answer",a)};c.onaddstream=function(a){this.options.remote.src=URL.createObjectURL(a.stream)}.bind(this),c.onicecandidate=function(a){a.candidate&&(b.emit("hello:ice",a.candidate),c.onicecandidate=null)},c.onopen=function(){},b.on("hello:offer",function(a){c.setRemoteDescription(new RTCSessionDescription(a)),c.createAnswer(d)}),b.on("hello:answer",function(a){c.setRemoteDescription(new RTCSessionDescription(a))}.bind(this)),b.on("hello:ice",function(a){c.addIceCandidate(new RTCIceCandidate(a))}),b.on("hello:call",function(a){this.pendingCalls[a]=new Date,this._events.call&&this._events.call(a)}.bind(this)),this.socket=b,this.stream=null,this.pendingCalls={},this.peerConnection=c};Hello.prototype.on=function(a,b){this._events[a]=b},Hello.prototype.register=function(a){this.socket.emit("hello:register",a)},Hello.prototype.call=function(a){var b={audio:!0,video:!0},c=function(b){this.stream=b,this.peerConnection.addStream(this.stream),this.options.local.src=URL.createObjectURL(b),this.socket.emit("hello:call",a)}.bind(this),d=function(){console.error(arguments)};navigator.getUserMedia(b,c,d)},Hello.prototype.answer=function(a){var b=this.pendingCalls[a],c={audio:!0,video:!0};if(b){var d=function(a){this.stream=a,this.options.local.src=URL.createObjectURL(a),this.peerConnection.addStream(this.stream),this.peerConnection.createOffer(function(a){this.peerConnection.setLocalDescription(a),this.socket.emit("hello:offer",a)}.bind(this))}.bind(this),e=function(){console.error(arguments)};navigator.getUserMedia(c,d,e)}};
//# sourceMappingURL=hellortc.map.js